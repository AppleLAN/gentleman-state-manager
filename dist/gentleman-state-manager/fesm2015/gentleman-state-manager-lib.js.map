{"version":3,"file":"gentleman-state-manager-lib.js","sources":["../../../projects/gentleman-state-manager/src/lib/utils/functionalities.ts","../../../projects/gentleman-state-manager/src/lib/models/gentleman-state-object.ts","../../../projects/gentleman-state-manager/src/lib/services/gentleman-state.service.ts","../../../projects/gentleman-state-manager/src/lib/gentleman-state-manager.module.ts","../../../projects/gentleman-state-manager/src/public-api.ts","../../../projects/gentleman-state-manager/src/gentleman-state-manager-lib.ts"],"sourcesContent":["import {Condition} from '../models/utils';\r\n\r\n/**\r\n * @desc checks if the condition is met and returns its value\r\n * @param condition - the condition to check\r\n * @param errorMessage - the error message to be shown if the condition is not met\r\n * @return any\r\n */\r\n\r\nexport function checkIfConditionMet(condition: () => Condition, errorMessage: string): any {\r\n  const conditionMet = condition();\r\n  if (!conditionMet.met) {\r\n    console.error(errorMessage);\r\n    throw Error(errorMessage);\r\n  }\r\n  return conditionMet.value;\r\n}\r\n","import { BehaviorSubject, Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { checkIfConditionMet } from '../utils/public-api';\r\nimport { StateProperties, TypeWithKey } from './public-api';\r\n\r\nexport class GentlemanStateObject {\r\n  private state: any;\r\n  private stateProperties: StateProperties = {};\r\n  readonly observableSubject: BehaviorSubject<any>;\r\n\r\n  constructor(state: any, stateProperties: StateProperties) {\r\n    this.state = state;\r\n    this.stateProperties = stateProperties;\r\n    this.observableSubject = new BehaviorSubject(state);\r\n  }\r\n\r\n  /**\r\n   * @desc returns the observable that contains the state for async operations - it listens for changes\r\n   * @return Observable\r\n   */\r\n  getObservable(): Observable<any> {\r\n    return this.observableSubject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * @desc returns the state properties object\r\n   * @return StateProperties\r\n   */\r\n  getStateProperties(): StateProperties {\r\n    return this.stateProperties;\r\n  }\r\n\r\n  /**\r\n   * @desc unsubscribes from the observable\r\n   * @return void\r\n   */\r\n  unsubscribe(): void {\r\n    this.observableSubject.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * @desc returns the value of the state at the time of the call\r\n   * @return any\r\n   */\r\n  getStateSnapshot(): any {\r\n    return { ...this.state };\r\n  }\r\n\r\n  /**\r\n   * @desc returns the value of a property of the state at the time of the call\r\n   * @param property - the name of the requested property\r\n   * @return any\r\n   */\r\n  getPropertyFromState(property: string): any {\r\n    return this.state[property];\r\n  }\r\n\r\n  /**\r\n   * @desc returns the value of a property of the state for async operations - it listens for changes\r\n   * @param property - the name of the requested property\r\n   * @return Observable\r\n   */\r\n  getPropertyFromObservable(property: string): Observable<any> {\r\n    return this.getObservable().pipe(map((s) => this.checkIfPropertyExists(s, property)));\r\n  }\r\n\r\n  /**\r\n   * @desc sets the value for a certain property inside the state, triggers an async event\r\n   * @param value - the value for the requested property\r\n   * @param property - the name of the requested property\r\n   * @param emit - if true it will trigger an async event\r\n   * @return void\r\n   */\r\n  setObservableValues(value: any, property: string | null = null, emit = true): void {\r\n    this.setStateValues(value, property);\r\n    if (emit) {\r\n      this.observableSubject.next(this.state);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc sets the value for a certain property inside the state, doesn't triggers an async event\r\n   * @param value - the value for the requested property\r\n   * @param property - the name of the requested property, if no property it will try to patch the values into the state\r\n   * @return void\r\n   */\r\n  setStateValues(value: any, property: string | null): void {\r\n    if (property && this.checkIfPropertyExists(this.state, property) !== undefined) {\r\n      (this.state as TypeWithKey<any>)[property] = value;\r\n    } else {\r\n      this.state = {\r\n        ...this.state,\r\n        ...value,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc resets the state\r\n   * @return void\r\n   */\r\n  resetState(): void {\r\n    (this.state as TypeWithKey<any>) = {};\r\n  }\r\n\r\n  /**\r\n   * @desc checks if the selected property exists inside the state\r\n   * @param state - the state of the observable, the object that represents what the observable is going to contain\r\n   * @param property - the selected property\r\n   * @return any\r\n   */\r\n  private checkIfPropertyExists(state: any, property: string): any {\r\n    const condition = () => {\r\n      return { met: state.hasOwnProperty(property), value: state[property] };\r\n    };\r\n    return checkIfConditionMet(() => condition(), 'Selected property not found ! check if the key is correct and exists');\r\n  }\r\n}\r\n","import { Inject, Injectable } from \"@angular/core\";\r\nimport { GentlemanStateObject, StateProperties } from \"../models/public-api\";\r\nimport { SourceOfTruth, SourceOfTruthInitiate } from \"../models/source-of-truth\";\r\nimport { checkIfConditionMet } from \"../utils/public-api\";\r\n\r\n@Injectable({\r\n  providedIn: \"root\",\r\n})\r\nexport class GentlemanStateService {\r\n  private observerArray: SourceOfTruth = new Map();\r\n\r\n  constructor(@Inject(\"sourceOfTruthKeys\") sourceOfTruthKeys: SourceOfTruthInitiate[]) {\r\n    sourceOfTruthKeys.forEach((k) => {\r\n      const { state, stateProperties } = k;\r\n      this.createObservable(k.key, state, stateProperties);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @desc it checks if the searched object exists, if not it throws an errors and stops the execution.\r\n   * @param gentlemanObject - GentlemanStateObject | undefined\r\n   * @return GentlemanStateObject\r\n   */\r\n  private static checkIfFound(gentlemanObject: GentlemanStateObject | undefined): GentlemanStateObject {\r\n    const condition = () => {\r\n      return { met: !!gentlemanObject, value: gentlemanObject };\r\n    };\r\n    return checkIfConditionMet(() => condition(), \"Observable item not found ! check if the key is correct and exists\");\r\n  }\r\n\r\n  /**\r\n   * @desc it creates and observable and adds it to the observable array.\r\n   * @param key - the key to be used to represent the observable item inside the array\r\n   * @param state - the state of the observable, the object that represents what the observable is going to contain\r\n   * @param stateProperties - the properties of the state\r\n   * @return void\r\n   */\r\n  createObservable(key: string, state: any, stateProperties: StateProperties): void {\r\n    const found = this.observerArray.has(key);\r\n    if (found) {\r\n      console.log(`the key : ${key}, already exists as an entity so it will be ignored`);\r\n    } else {\r\n      const gentlemanObject = new GentlemanStateObject(state, stateProperties);\r\n      this.observerArray.set(key, gentlemanObject);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc it returns the selected observable using the provided key.\r\n   * @param key - the key to be used to represent the observable item inside the array\r\n   * @return GentlemanStateObject\r\n   */\r\n  getEntity(key: string): GentlemanStateObject {\r\n    const observableArrayItem = GentlemanStateService.checkIfFound(this.observerArray.get(key));\r\n    return observableArrayItem;\r\n  }\r\n\r\n  /**\r\n   * @desc it emits a new value into the selected observable using the provided key.\r\n   * @param key - the key to be used to represent the observable item inside the array\r\n   * @param data - the data to be emitted inside the selected observable\r\n   * @return void\r\n   */\r\n  emitValue(key: string, data: any): void {\r\n    const observableArrayItem = GentlemanStateService.checkIfFound(this.observerArray.get(key));\r\n    observableArrayItem.setObservableValues(data);\r\n  }\r\n\r\n  /**\r\n   * @desc it destroys an object from the observable array.\r\n   * @param key - the key to be used to represent the observable item inside the array\r\n   * @return void\r\n   */\r\n  destroyObservable(key: string): void {\r\n    const selectedObservable = GentlemanStateService.checkIfFound(this.observerArray.get(key));\r\n    selectedObservable.unsubscribe();\r\n    this.observerArray.delete(key);\r\n  }\r\n}\r\n","import {ModuleWithProviders, NgModule} from '@angular/core';\r\nimport {SourceOfTruthInitiate} from './models/source-of-truth';\r\nimport {GentlemanStateService} from './services/public-api';\r\n\r\n\r\n@NgModule({\r\n  declarations: [],\r\n  imports: [],\r\n  exports: []\r\n})\r\nexport class GentlemanStateManagerModule {\r\n  static forRoot(sourceOfTruthKeys: SourceOfTruthInitiate[]): ModuleWithProviders<GentlemanStateManagerModule> {\r\n    return {\r\n      ngModule: GentlemanStateManagerModule,\r\n      providers: [GentlemanStateService, {provide: 'sourceOfTruthKeys', useValue: sourceOfTruthKeys}]\r\n    };\r\n  }\r\n}\r\n","/*\r\n * Public API Surface of gentleman-state-manager\r\n */\r\n\r\nexport * from './lib/public-api';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;AAEA;;;;;;SAOgB,mBAAmB,CAAC,SAA0B,EAAE,YAAoB;IAClF,MAAM,YAAY,GAAG,SAAS,EAAE,CAAC;IACjC,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE;QACrB,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QAC5B,MAAM,KAAK,CAAC,YAAY,CAAC,CAAC;KAC3B;IACD,OAAO,YAAY,CAAC,KAAK,CAAC;AAC5B;;MCXa,oBAAoB;IAK/B,YAAY,KAAU,EAAE,eAAgC;QAHhD,oBAAe,GAAoB,EAAE,CAAC;QAI5C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;QACvC,IAAI,CAAC,iBAAiB,GAAG,IAAI,eAAe,CAAC,KAAK,CAAC,CAAC;KACrD;;;;;IAMD,aAAa;QACX,OAAO,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC;KAC9C;;;;;IAMD,kBAAkB;QAChB,OAAO,IAAI,CAAC,eAAe,CAAC;KAC7B;;;;;IAMD,WAAW;QACT,IAAI,CAAC,iBAAiB,CAAC,WAAW,EAAE,CAAC;KACtC;;;;;IAMD,gBAAgB;QACd,yBAAY,IAAI,CAAC,KAAK,EAAG;KAC1B;;;;;;IAOD,oBAAoB,CAAC,QAAgB;QACnC,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;KAC7B;;;;;;IAOD,yBAAyB,CAAC,QAAgB;QACxC,OAAO,IAAI,CAAC,aAAa,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,qBAAqB,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;KACvF;;;;;;;;IASD,mBAAmB,CAAC,KAAU,EAAE,WAA0B,IAAI,EAAE,IAAI,GAAG,IAAI;QACzE,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QACrC,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACzC;KACF;;;;;;;IAQD,cAAc,CAAC,KAAU,EAAE,QAAuB;QAChD,IAAI,QAAQ,IAAI,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC,KAAK,SAAS,EAAE;YAC7E,IAAI,CAAC,KAA0B,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;SACpD;aAAM;YACL,IAAI,CAAC,KAAK,mCACL,IAAI,CAAC,KAAK,GACV,KAAK,CACT,CAAC;SACH;KACF;;;;;IAMD,UAAU;QACP,IAAI,CAAC,KAA0B,GAAG,EAAE,CAAC;KACvC;;;;;;;IAQO,qBAAqB,CAAC,KAAU,EAAE,QAAgB;QACxD,MAAM,SAAS,GAAG;YAChB,OAAO,EAAE,GAAG,EAAE,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC;SACxE,CAAC;QACF,OAAO,mBAAmB,CAAC,MAAM,SAAS,EAAE,EAAE,sEAAsE,CAAC,CAAC;KACvH;;;MC5GU,qBAAqB;IAGhC,YAAyC,iBAA0C;QAF3E,kBAAa,GAAkB,IAAI,GAAG,EAAE,CAAC;QAG/C,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;YAC1B,MAAM,EAAE,KAAK,EAAE,eAAe,EAAE,GAAG,CAAC,CAAC;YACrC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,eAAe,CAAC,CAAC;SACtD,CAAC,CAAC;KACJ;;;;;;IAOO,OAAO,YAAY,CAAC,eAAiD;QAC3E,MAAM,SAAS,GAAG;YAChB,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC,eAAe,EAAE,KAAK,EAAE,eAAe,EAAE,CAAC;SAC3D,CAAC;QACF,OAAO,mBAAmB,CAAC,MAAM,SAAS,EAAE,EAAE,oEAAoE,CAAC,CAAC;KACrH;;;;;;;;IASD,gBAAgB,CAAC,GAAW,EAAE,KAAU,EAAE,eAAgC;QACxE,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC1C,IAAI,KAAK,EAAE;YACT,OAAO,CAAC,GAAG,CAAC,aAAa,GAAG,qDAAqD,CAAC,CAAC;SACpF;aAAM;YACL,MAAM,eAAe,GAAG,IAAI,oBAAoB,CAAC,KAAK,EAAE,eAAe,CAAC,CAAC;YACzE,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,EAAE,eAAe,CAAC,CAAC;SAC9C;KACF;;;;;;IAOD,SAAS,CAAC,GAAW;QACnB,MAAM,mBAAmB,GAAG,qBAAqB,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAC5F,OAAO,mBAAmB,CAAC;KAC5B;;;;;;;IAQD,SAAS,CAAC,GAAW,EAAE,IAAS;QAC9B,MAAM,mBAAmB,GAAG,qBAAqB,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAC5F,mBAAmB,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;KAC/C;;;;;;IAOD,iBAAiB,CAAC,GAAW;QAC3B,MAAM,kBAAkB,GAAG,qBAAqB,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAC3F,kBAAkB,CAAC,WAAW,EAAE,CAAC;QACjC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;KAChC;;0FArEU,qBAAqB,cAGZ,mBAAmB;2EAH5B,qBAAqB,WAArB,qBAAqB,mBAFpB,MAAM;uFAEP,qBAAqB;cAHjC,UAAU;eAAC;gBACV,UAAU,EAAE,MAAM;aACnB;;sBAIc,MAAM;uBAAC,mBAAmB;;;MCD5B,2BAA2B;IACtC,OAAO,OAAO,CAAC,iBAA0C;QACvD,OAAO;YACL,QAAQ,EAAE,2BAA2B;YACrC,SAAS,EAAE,CAAC,qBAAqB,EAAE,EAAC,OAAO,EAAE,mBAAmB,EAAE,QAAQ,EAAE,iBAAiB,EAAC,CAAC;SAChG,CAAC;KACH;;sGANU,2BAA2B;6EAA3B,2BAA2B;iFAH7B,EAAE;uFAGA,2BAA2B;cALvC,QAAQ;eAAC;gBACR,YAAY,EAAE,EAAE;gBAChB,OAAO,EAAE,EAAE;gBACX,OAAO,EAAE,EAAE;aACZ;;;ACTD;;;;ACAA;;;;;;"}